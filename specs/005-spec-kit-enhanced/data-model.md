# Data Model: Spec-Kit Enhanced Fork v2.0

**Feature**: 005-spec-kit-enhanced  
**Date**: 2025-09-30  
**Note**: This is a framework enhancement, not a traditional application. "Entities" represent file structures and workflow states rather than database models.

---

## Key Entities

### 1. Feature Specification (spec.md)

**Purpose**: Define what system provides and why  
**Attributes**:
- `feature_id`: string (e.g., "005")
- `title`: string
- `status`: enum (draft, approved, implemented)
- `created`: date (YYYY-MM-DD)
- `complexity_level`: enum (low, medium, high, very_high)
- `research_conducted`: boolean
- `mvp_platforms`: array of strings

**Relationships**:
- Parent of: plan.md, tasks.md, research.md, artifacts
- Referenced by: All workflow commands

**Validation Rules**:
- feature_id MUST match folder name `specs/{feature_id}-{slug}/`
- All YAML frontmatter fields MUST be present
- No [NEEDS CLARIFICATION] markers in approved specs

**State Transitions**:
```
draft → approved (after /clarify resolves all ambiguities)
approved → implemented (after /implement completes all tasks)
```

---

### 2. Implementation Plan (plan.md)

**Purpose**: Design artifacts and technical approach  
**Attributes**:
- `feature_id`: string (inherited from spec.md)
- `parent_spec`: string (reference to spec.md)
- `phase`: enum (0-research, 1-design, 2-tasks, 3-implementation, 4-validation)
- `constitution_check`: enum (pass, fail-justified, fail-blocked)

**Relationships**:
- Child of: spec.md
- Parent of: research.md, data-model.md, contracts/*, quickstart.md
- Sibling of: tasks.md

**Validation Rules**:
- MUST reference existing spec.md via `parent_spec`
- Constitution check MUST pass before Phase 1
- All NEEDS CLARIFICATION from spec MUST be resolved

---

### 3. Task List (tasks.md)

**Purpose**: Ordered, actionable implementation tasks  
**Attributes**:
- `feature_id`: string
- `parent_spec`: string
- `tasks`: array of:
  - `id`: string (T### format)
  - `title`: string
  - `files_affected`: array of paths
  - `test_required`: boolean
  - `dependencies`: array of task IDs
  - `status`: enum (pending, in-progress, completed)

**Relationships**:
- Child of: spec.md
- Sibling of: plan.md
- References: Source code files via `files_affected`

**Validation Rules**:
- task_id MUST follow T### pattern
- `dependencies` MUST reference existing task IDs
- No circular dependencies (validated by `build-task-graph.sh`)
- Each `files_affected` path MUST be tracked in file-history.json if renamed

---

### 4. Research Findings (research.md)

**Purpose**: Document research for complex features  
**Attributes**:
- `feature_id`: string
- `research_passes`: number
- `domains`: array of research topics
- `sources`: array of URLs

**Relationships**:
- Child of: plan.md
- Referenced by: Technical decisions in plan

**Validation Rules**:
- All technology recommendations MUST cite sources (URLs)
- Each decision MUST have rationale

---

### 5. File History Tracker (.specify/file-history.json)

**Purpose**: Track file renames and deprecations  
**Schema**:
```json
{
  "renames": [
    {
      "old_path": "src/old-file.ts",
      "new_path": "src/new-file.ts",
      "task_id": "T001",
      "timestamp": "2025-09-30T12:00:00Z",
      "branch": "005-spec-kit-enhanced"
    }
  ],
  "deprecated": [
    {
      "path": "src/legacy-api.ts",
      "reason": "Replaced by new-api.ts",
      "task_id": "T005",
      "timestamp": "2025-09-30T13:00:00Z"
    }
  ]
}
```

**Relationships**:
- Referenced by: sync-tasks.sh, validate-governance.md workflow
- Updated by: track-file-rename.sh, mark-file-deprecated.sh

---

### 6. Workflow Context (.specify/context.json)

**Purpose**: Track workflow state across commands  
**Schema**:
```json
{
  "complexity_level": "very_high",
  "complexity_score": 45,
  "multi_domain": true,
  "research_complete": true,
  "research_passes_completed": 5,
  "spec_created": true,
  "clarifications_resolved": 10,
  "feature_id": "005",
  "next_workflow": "/plan"
}
```

**Relationships**:
- Updated by: /specify, /clarify, /plan, /tasks workflows
- Read by: All workflow commands for state management

**Validation Rules**:
- feature_id MUST match current Git branch
- Workflow transitions MUST follow order: /specify → /clarify → /plan → /tasks → /implement

---

### 7. Platform-Specific Agent Files

**Examples**: CLAUDE.md, WINDSURF.md, CURSOR.md, ROO.md  
**Purpose**: Platform-specific workflow instructions  
**Attributes**:
- `platform`: string
- `workflow_syntax`: instructions
- `mcp_tools`: array of available tools
- `recent_changes`: array of last 3 updates

**Relationships**:
- Generated by: plan workflow via update-agent-context.sh
- Referenced by: AI agents on specific platforms

**Validation Rules**:
- MUST be <150 lines for token efficiency
- Recent changes MUST show only last 3 updates
- Manual additions between markers MUST be preserved

---

### 8. Script Output (JSON)

**Purpose**: Standardized script output for agent parsing  
**Examples**: analyze-codebase.sh, check-dependencies.sh, sync-tasks.sh  
**Schema Template**:
```json
{
  "status": "success|warning|error",
  "data": {},
  "messages": [
    {
      "level": "INFO|WARN|ERROR",
      "message": "Human-readable description",
      "location": "file:line" 
    }
  ]
}
```

**Relationships**:
- Consumed by: AI agents executing workflows
- Validated by: Cross-platform parity tests (bash output === PowerShell output)

**Validation Rules**:
- MUST be valid JSON
- Bash and PowerShell versions MUST produce identical output
- All paths MUST be absolute

---

## Entity Relationships Diagram

```
spec.md (root)
├── plan.md
│   ├── research.md
│   ├── data-model.md (this file)
│   ├── contracts/
│   └── quickstart.md
└── tasks.md
    └── files_affected[] → source code files
                           → tracked in file-history.json

.specify/context.json ← updated by all workflows
.specify/file-history.json ← updated by task execution

Platform files (CLAUDE.md, etc.) ← generated from plan.md
```

---

## Validation Workflows

**1. Artifact Naming Convention**:
- All artifacts MUST follow `{feature_id}-{slug}` pattern
- Validated by: `validate-naming.sh`

**2. Metadata Completeness**:
- All YAML frontmatter MUST have required fields
- Validated by: `validate-frontmatter.sh`

**3. Document Relationships**:
- All `parent_spec` references MUST resolve
- Validated by: `validate-governance.md` workflow

**4. File Tracking**:
- All files in `files_affected` MUST exist or be in file-history.json
- Validated by: `sync-tasks.sh --validate`

---

**Data Model Complete** ✅  
This framework operates on file-based entities rather than database models.
